#{extends 'main.html' /}
#{set title:'Home' /}

<div id="board"></div>

<script>

var board = {};
var pieces = {};
var piececounter = 0;

function allowDrop(ev)
{
ev.preventDefault();
}

function drag(ev)
{
ev.dataTransfer.setData("from",ev.target.parentElement.id);
ev.dataTransfer.setData("piece",ev.target.id);
}

function drop(ev)
{
ev.preventDefault();
from=ev.dataTransfer.getData("from");
piece=ev.dataTransfer.getData("piece");
pieces[piece].appendTo(ev.target);
}

function drawField(field){
   xPos = 40*field.XPosition + 100;
   yPos = 40*field.YPosition + 100;
   
   fieldId = "field" + field.XPosition + "x" + field.YPosition;
   
   div = $("<div/>", {class:"field", id: fieldId, style: "top:"+xPos+"px; left:"+yPos+"px",
     ondrop:"drop(event)", ondragover:"allowDrop(event)"});
   
   board[fieldId] = div;
   
   if(field.isCorner){
   	div.addClass("corner");
   }
   if(field.isThrone){
   	div.addClass("throne");
   }
   
   div.appendTo("#board");
   
   if(field.piece != null){
     piececounter++;
     pieceId = "piece" + piececounter;
     var piece;
     
   	 if(field.piece.side == "BLACK")
   	   piece = $("<div/>", {class:"piece black", id: pieceId, draggable:"true", ondragstart:"drag(event)"});
   	 else{
   	   piece = $("<div/>", {class:"piece white", id: pieceId, draggable:"true", ondragstart:"drag(event)"});
   	 }
   	 
   	 pieces[pieceId] = piece;
   	 piece.appendTo(div);
   }   
}

$.ajax({
  url: "@{Application.getBoard(1)}"
}).done(function ( data ) {
  for(var i = 0; i < 9; i++){
  	for(var j = 0; j < 9; j++){
  	  console.log(i + "," + j);
  	  drawField(data.board[i][j]);
  	}
  }
});

</script>